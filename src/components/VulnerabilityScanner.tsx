import { Card } from "./ui/card";
import { Badge } from "./ui/badge";
import { Button } from "./ui/button";
import { Progress } from "./ui/progress";
import { AlertTriangle, CheckCircle, XCircle, Clock, Play } from "lucide-react";

interface Vulnerability {
  id: string;
  title: string;
  severity: "critical" | "high" | "medium" | "low";
  description: string;
  affected: string;
  cvss: number;
  status: "open" | "patched" | "mitigated";
  discovered: string;
}

const vulnerabilities: Vulnerability[] = [
  {
    id: "CVE-2024-0001",
    title: "Inyección SQL en Autenticación de Usuario",
    severity: "critical",
    description: "Potencial vulnerabilidad de inyección SQL en formulario de login permitiendo acceso no autorizado",
    affected: "Aplicación Web v2.1",
    cvss: 9.8,
    status: "open",
    discovered: "hace 2 días"
  },
  {
    id: "CVE-2024-0002", 
    title: "Librería OpenSSL Desactualizada",
    severity: "high",
    description: "Servidor ejecutando versión vulnerable de librería OpenSSL",
    affected: "Servidor Web (192.168.1.10)",
    cvss: 7.5,
    status: "open",
    discovered: "hace 1 semana"
  },
  {
    id: "CVE-2024-0003",
    title: "Política de Contraseñas Débil",
    severity: "medium",
    description: "La política actual de contraseñas permite contraseñas débiles",
    affected: "Sistema de Gestión de Usuarios",
    cvss: 5.3,
    status: "mitigated",
    discovered: "hace 2 semanas"
  },
  {
    id: "CVE-2023-9999",
    title: "Cross-Site Scripting (XSS)",
    severity: "medium",
    description: "Vulnerabilidad XSS almacenado en sección de comentarios de usuarios",
    affected: "Aplicación Web v2.1",
    cvss: 6.1,
    status: "patched",
    discovered: "hace 1 mes"
  },
  {
    id: "CVE-2023-9998",
    title: "Transmisión de Datos No Cifrada",
    severity: "low",
    description: "Algunas comunicaciones internas no usan HTTPS",
    affected: "API Interna",
    cvss: 3.7,
    status: "open",
    discovered: "hace 3 semanas"
  }
];

const getSeverityColor = (severity: Vulnerability["severity"]) => {
  switch (severity) {
    case "critical": return "text-red-600 bg-red-100";
    case "high": return "text-orange-600 bg-orange-100";
    case "medium": return "text-yellow-600 bg-yellow-100";
    case "low": return "text-green-600 bg-green-100";
  }
};

const getStatusIcon = (status: Vulnerability["status"]) => {
  switch (status) {
    case "open": return <XCircle className="h-4 w-4 text-red-600" />;
    case "patched": return <CheckCircle className="h-4 w-4 text-green-600" />;
    case "mitigated": return <Clock className="h-4 w-4 text-yellow-600" />;
  }
};

const getCvssColor = (cvss: number) => {
  if (cvss >= 9.0) return "text-red-600";
  if (cvss >= 7.0) return "text-orange-600";
  if (cvss >= 4.0) return "text-yellow-600";
  return "text-green-600";
};

export function VulnerabilityScanner() {
  const criticalCount = vulnerabilities.filter(v => v.severity === "critical").length;
  const highCount = vulnerabilities.filter(v => v.severity === "high").length;
  const openCount = vulnerabilities.filter(v => v.status === "open").length;
  const scanProgress = 78;

  return (
    <div className="space-y-6">
      <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
        <Card className="p-6">
          <div className="flex items-center gap-3">
            <AlertTriangle className="h-8 w-8 text-red-600" />
            <div>
              <p className="text-sm text-muted-foreground">Critical</p>
              <h3 className="text-2xl">{criticalCount}</h3>
            </div>
          </div>
        </Card>

        <Card className="p-6">
          <div className="flex items-center gap-3">
            <AlertTriangle className="h-8 w-8 text-orange-600" />
            <div>
              <p className="text-sm text-muted-foreground">High</p>
              <h3 className="text-2xl">{highCount}</h3>
            </div>
          </div>
        </Card>

        <Card className="p-6">
          <div className="flex items-center gap-3">
            <XCircle className="h-8 w-8 text-red-600" />
            <div>
              <p className="text-sm text-muted-foreground">Open Issues</p>
              <h3 className="text-2xl">{openCount}</h3>
            </div>
          </div>
        </Card>

        <Card className="p-6">
          <div className="flex items-center gap-3">
            <Play className="h-8 w-8 text-blue-600" />
            <div>
              <p className="text-sm text-muted-foreground">Scan Progress</p>
              <div className="flex items-center gap-2">
                <Progress value={scanProgress} className="w-16" />
                <span className="text-sm">{scanProgress}%</span>
              </div>
            </div>
          </div>
        </Card>
      </div>

      <Card className="p-6">
        <div className="flex justify-between items-center mb-6">
          <h3>Vulnerability Assessment</h3>
          <div className="flex gap-2">
            <Button variant="outline" size="sm">
              Export Report
            </Button>
            <Button size="sm">
              <Play className="h-4 w-4 mr-2" />
              Start Scan
            </Button>
          </div>
        </div>

        <div className="space-y-4">
          {vulnerabilities.map((vuln) => (
            <div key={vuln.id} className="border rounded-lg p-4">
              <div className="flex items-start justify-between">
                <div className="flex-1">
                  <div className="flex items-center gap-3 mb-2">
                    {getStatusIcon(vuln.status)}
                    <h4 className="font-medium">{vuln.title}</h4>
                    <Badge className={getSeverityColor(vuln.severity)}>
                      {vuln.severity.toUpperCase()}
                    </Badge>
                    <span className={`text-sm font-medium ${getCvssColor(vuln.cvss)}`}>
                      CVSS {vuln.cvss}
                    </span>
                  </div>
                  
                  <p className="text-sm text-muted-foreground mb-2">
                    {vuln.description}
                  </p>
                  
                  <div className="flex items-center gap-6 text-xs text-muted-foreground">
                    <div>ID: {vuln.id}</div>
                    <div>Affected: {vuln.affected}</div>
                    <div>Discovered: {vuln.discovered}</div>
                  </div>
                </div>
                
                <div className="flex gap-2">
                  <Button size="sm" variant="outline">
                    Details
                  </Button>
                  {vuln.status === "open" && (
                    <Button size="sm">
                      Remediate
                    </Button>
                  )}
                </div>
              </div>
            </div>
          ))}
        </div>
      </Card>
    </div>
  );
}